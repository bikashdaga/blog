<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tutorial: Integrating Python with Compiler Languages | Ashton’s Tech Tales</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Tutorial: Integrating Python with Compiler Languages" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Create a Python wrapper for functions written in Go." />
<meta property="og:description" content="Create a Python wrapper for functions written in Go." />
<link rel="canonical" href="https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html" />
<meta property="og:url" content="https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html" />
<meta property="og:site_name" content="Ashton’s Tech Tales" />
<meta property="og:image" content="https://ashton-sidhu.github.io/blog/images/ctypes/architecture.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-25T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html","headline":"Tutorial: Integrating Python with Compiler Languages","datePublished":"2020-10-25T00:00:00-05:00","dateModified":"2020-10-25T00:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html"},"image":"https://ashton-sidhu.github.io/blog/images/ctypes/architecture.png","description":"Create a Python wrapper for functions written in Go.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://ashton-sidhu.github.io/blog/feed.xml" title="Ashton's Tech Tales" /><!-- the google_analytics_id gets auto inserted from the config file -->




<script async src="https://www.googletagmanager.com/gtag/js?id=G-51W5VE9GNG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-51W5VE9GNG');
</script>




<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tutorial: Integrating Python with Compiler Languages | Ashton’s Tech Tales</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Tutorial: Integrating Python with Compiler Languages" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Create a Python wrapper for functions written in Go." />
<meta property="og:description" content="Create a Python wrapper for functions written in Go." />
<link rel="canonical" href="https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html" />
<meta property="og:url" content="https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html" />
<meta property="og:site_name" content="Ashton’s Tech Tales" />
<meta property="og:image" content="https://ashton-sidhu.github.io/blog/images/ctypes/architecture.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-25T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html","headline":"Tutorial: Integrating Python with Compiler Languages","datePublished":"2020-10-25T00:00:00-05:00","dateModified":"2020-10-25T00:00:00-05:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://ashton-sidhu.github.io/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html"},"image":"https://ashton-sidhu.github.io/blog/images/ctypes/architecture.png","description":"Create a Python wrapper for functions written in Go.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico">
<link rel="apple-touch-icon" sizes="57x57" href="images/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="images/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="images/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="images/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="images/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="images/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="images/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="images/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>


<script type="text/javascript" src="https://platform.linkedin.com/badges/js/profile.js" async defer></script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Ashton&#39;s Tech Tales</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Tutorial: Integrating Python with Compiler Languages</h1><p class="page-description">Create a Python wrapper for functions written in Go.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-10-25T00:00:00-05:00" itemprop="datePublished">
        Oct 25, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#data science">data science</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#go">go</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#machine learning">machine learning</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#interpreters-vs-compilers">Interpreters vs. Compilers</a></li>
<li class="toc-entry toc-h2"><a href="#c-types">C Types</a></li>
<li class="toc-entry toc-h2"><a href="#walk-through">Walk Through</a></li>
<li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li>
<li class="toc-entry toc-h2"><a href="#feedback">Feedback</a></li>
</ul><p>Python - a programming language that is human readable, easy to learn, and most importantly, easy to use. It is no wonder that it is one of the most popular languages today. From being able to build web applications, create automation scripts, analyze data and build machine learning models, Python is a jack of all trades. As with anything it has its short comings which include its speed and lack of granular access to machine hardware. This is due to Python being an interpreter-based language and not a compiler-based language.</p>

<p>Luckily for us, there is a way to solve that problem. Python has a native library that allows you to use functions built in compiled languages. This gives you the ability to leverage both the powers of Python and compiler based languages. Some of the most popular data science libraries such as <a href="https://github.com/pandas-dev/pandas/tree/7829ad3290dc6894d24c1c853ffc4dabef50294a/pandas/_libs/src">Pandas</a> and <a href="https://github.com/dmlc/xgboost/tree/master/src">XGBoost</a> have modules written in C/C++ (compiler-based languages) to overcome Python’s speed and performance issues while still having a user friendly Python API.</p>

<p>In this post, we are going to walk through interpreter based languages vs. compiler based languages, Python’s built in <code class="language-plaintext highlighter-rouge">ctypes</code> module and an example of how to use modules built from a compiled language. From there you will be able to integrate Python with other languages in your data science or machine learning projects.</p>

<h2 id="interpreters-vs-compilers">
<a class="anchor" href="#interpreters-vs-compilers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interpreters vs. Compilers</h2>
<p>As I mentioned above, Python is an interpreted language. In order to execute code on a machine, the code first has to get translated to “machine code”.</p>

<div class="Toast" style="max-width: 100%;">
   <span class="Toast-icon"><svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg></span>
   <span class="Toast-content">Machine code is just binary or hexadecimal instructions.</span>
</div>

<p>The main difference between interpreted and compiled languages is that interpreted languages get executed line by line and passed through a translator that converts each line to machine code.</p>

<p>Compilers require a build step that translates all the code at once into an application (or binary) that can be executed. During the build phase there is a compiler that will optimize the translation from written code to machine code. The compiler’s optimizations are one of compiled based-languages are faster than interpreter-based languages. Common compiled languages are C, C++ and Go.</p>

<div class="Toast" style="max-width: 100%;">
   <span class="Toast-icon"><svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg></span>
   <span class="Toast-content">This a high level comparison between interpreters and compilers. More in-depth knowledge would require individual research or a separate topic entirely.</span>
</div>

<h2 id="c-types">
<a class="anchor" href="#c-types" aria-hidden="true"><span class="octicon octicon-link"></span></a>C Types</h2>
<p>Python has built in libraries to be able to call modules built in compiled languages. It gives developers the ultimate flexibility to use compiled languages for tasks that Python isn’t well equipped to handle - all the while still building the core of the application in Python.</p>

<p>The main library that we will be using to interact with modules from a compiled application is  <a href="https://docs.python.org/3/library/ctypes.html">ctypes.</a>  It provides C compatible data types and calling functions from applications built in compiled languages. It gives you the ability to wrap these languages in pure Python. To be able to do this, Python first has to convert its function argument types into C native types. This allows it to be compatible with compiled language function’s argument types. The figure below explains the process at a high level when interacting with functions from compiled languages.</p>

<div class="Toast" style="max-width: 100%;">
   <span class="Toast-icon"><svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg></span>
   <span class="Toast-content">The example in the next section will be using Go so the image is Go specific, but the principle applies to the other compiled languages.</span>
</div>

<p><img src="/blog/images/ctypes/architecture.png" alt=""></p>

<h2 id="walk-through">
<a class="anchor" href="#walk-through" aria-hidden="true"><span class="octicon octicon-link"></span></a>Walk Through</h2>
<p>Below is a Go function I wrote that gets the closing price of a stock using the Alpha Vantage API. I’ll go over the key lines that allow us to create a Python wrapper for it.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"C"</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"encoding/json"</span>
	<span class="s">"fmt"</span>
	<span class="s">"io/ioutil"</span>
	<span class="s">"log"</span>
	<span class="s">"net/http"</span>
	<span class="s">"os"</span>
	<span class="s">"time"</span>
<span class="p">)</span>

<span class="c">// APIKEY ... Alpha Vantage API key, stored as env variable</span>
<span class="k">var</span> <span class="n">APIKEY</span> <span class="kt">string</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Getenv</span><span class="p">(</span><span class="s">"ALPHA_API_KEY"</span><span class="p">)</span>

<span class="c">// ENDPOINT ... Alpha Vantage API daily stock data endpoint</span>
<span class="k">var</span> <span class="n">ENDPOINT</span> <span class="kt">string</span> <span class="o">=</span> <span class="s">"https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED"</span>

<span class="c">// Data ... Data structure</span>
<span class="k">type</span> <span class="n">Data</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">MetaData</span>   <span class="n">MetaData</span>               <span class="s">`json:"Meta Data"`</span>
	<span class="n">TimeSeries</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span> <span class="s">`json:"Time Series (Daily)"`</span>
<span class="p">}</span>

<span class="c">// MetaData ... Stock metadata structure</span>
<span class="k">type</span> <span class="n">MetaData</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Info</span>        <span class="kt">string</span> <span class="s">`json:"1. Information"`</span>
	<span class="n">Symbol</span>      <span class="kt">string</span> <span class="s">`json:"2. Symbol"`</span>
	<span class="n">LastRefresh</span> <span class="kt">string</span> <span class="s">`json:"3. Last Refreshed"`</span>
	<span class="n">OutputSize</span>  <span class="kt">string</span> <span class="s">`json:"4. Output Size"`</span>
	<span class="n">TimeZone</span>    <span class="kt">string</span> <span class="s">`json:"5. Time Zone"`</span>
<span class="p">}</span>

<span class="c">// FinData ... Daily Financial Data json structure</span>
<span class="k">type</span> <span class="n">FinData</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Open</span>       <span class="kt">string</span> <span class="s">`json:"1. open"`</span>
	<span class="n">High</span>       <span class="kt">string</span> <span class="s">`json:"2. high"`</span>
	<span class="n">Low</span>        <span class="kt">string</span> <span class="s">`json:"3. low"`</span>
	<span class="n">Close</span>      <span class="kt">string</span> <span class="s">`json:"4. close"`</span>
	<span class="n">AdjClose</span>   <span class="kt">string</span> <span class="s">`json:"5. adjusted close"`</span>
	<span class="n">Volume</span>     <span class="kt">string</span> <span class="s">`json:"6. volume"`</span>
	<span class="n">DivAmount</span>  <span class="kt">string</span> <span class="s">`json:"7. dividend amount"`</span>
	<span class="n">SplitCoeff</span> <span class="kt">string</span> <span class="s">`json:"8. split coefficient"`</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{}</span>

<span class="c">//export getPrice</span>
<span class="k">func</span> <span class="n">getPrice</span><span class="p">(</span><span class="n">ticker</span> <span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">char</span><span class="p">,</span> <span class="n">date</span> <span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">char</span><span class="p">)</span> <span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">char</span> <span class="p">{</span>

	<span class="n">tickerDate</span> <span class="o">:=</span> <span class="n">C</span><span class="o">.</span><span class="n">GoString</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
	<span class="n">stock</span> <span class="o">:=</span> <span class="n">C</span><span class="o">.</span><span class="n">GoString</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

	<span class="n">query</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s&amp;symbol=%s&amp;apikey=%s"</span><span class="p">,</span> <span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">stock</span><span class="p">,</span> <span class="n">APIKEY</span><span class="p">)</span>

	<span class="n">client</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">Client</span><span class="p">{</span>
		<span class="n">Timeout</span><span class="o">:</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="m">10</span><span class="p">,</span> <span class="c">// Timeout after 5 seconds</span>
	<span class="p">}</span>

	<span class="n">req</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewRequest</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">MethodGet</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">req</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">"User-Agent"</span><span class="p">,</span> <span class="s">"stock-api-project"</span><span class="p">)</span>

	<span class="n">resp</span><span class="p">,</span> <span class="n">getErr</span> <span class="o">:=</span> <span class="n">client</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">getErr</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">getErr</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">defer</span> <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>

	<span class="n">respBody</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>

	<span class="n">dailyData</span> <span class="o">:=</span> <span class="n">Data</span><span class="p">{}</span>
	<span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">respBody</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dailyData</span><span class="p">)</span>

	<span class="c">// Encode Interface as bytes</span>
	<span class="n">dailyFinDataMap</span> <span class="o">:=</span> <span class="n">dailyData</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">[</span><span class="n">tickerDate</span><span class="p">]</span>
	<span class="n">dfdByte</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">dailyFinDataMap</span><span class="p">)</span>

	<span class="c">// Map interface to FinData struct</span>
	<span class="n">dailyFinData</span> <span class="o">:=</span> <span class="n">FinData</span><span class="p">{}</span>
	<span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">dfdByte</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dailyFinData</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">C</span><span class="o">.</span><span class="n">CString</span><span class="p">(</span><span class="n">dailyFinData</span><span class="o">.</span><span class="n">AdjClose</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">import “C”</code> - Import the <code class="language-plaintext highlighter-rouge">C</code> package (aka cgo) to have access to C data types.</p>

<p><code class="language-plaintext highlighter-rouge">func main() {}</code> -  An empty main function to ensure we still have an executable.</p>

<p><code class="language-plaintext highlighter-rouge">//export getPrice</code> - Export the function so that we can expose it to be accessed by Python.</p>

<p><code class="language-plaintext highlighter-rouge">func getPrice(ticker *C.char, date *C.char) *C.char {</code> - The function arguments need to be C types.</p>

<p><code class="language-plaintext highlighter-rouge">tickerDate := C.GoString(date)</code> - Convert the function arguments to their native Go types.</p>

<p><code class="language-plaintext highlighter-rouge">return C.CString(dailyFinData.AdjClose)</code> - The return value has to be a native C type.</p>

<p>To be able to use this in Python we have to compile this program, <code class="language-plaintext highlighter-rouge">go build -o stock-api.so -buildmode=c-shared main.go</code></p>

<p>Below is the associating Python wrapper that calls our exported Go function <code class="language-plaintext highlighter-rouge">getPrice</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">get_price</span><span class="p">(</span><span class="n">ticker</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="s">"""Gets the adjusted closing price of all stocks."""</span>

    <span class="n">lib</span> <span class="o">=</span> <span class="n">cdll</span><span class="p">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="s">"./stock-api.so"</span><span class="p">)</span>
    <span class="n">lib</span><span class="p">.</span><span class="n">getPrice</span><span class="p">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">c_char_p</span><span class="p">]</span>
    <span class="n">lib</span><span class="p">.</span><span class="n">getPrice</span><span class="p">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_char_p</span>

    <span class="n">curr_date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="n">today</span><span class="p">())</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">lib</span><span class="p">.</span><span class="n">getPrice</span><span class="p">(</span><span class="n">ticker</span><span class="p">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">curr_date</span><span class="p">.</span><span class="n">encode</span><span class="p">()).</span><span class="n">decode</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">price</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">from ctypes import *</code> - Import everything from ctypes as per the documentation.</p>

<p><code class="language-plaintext highlighter-rouge">lib = cdll.LoadLibrary("./stock-api.so")</code> - Load in the binary or compiled application.</p>

<p><code class="language-plaintext highlighter-rouge">lib.getPrice.argtypes = [c_char_p, c_char_p]</code> - Set the <code class="language-plaintext highlighter-rouge">getPrice</code> function argument types to the corresponding C types.</p>

<p><code class="language-plaintext highlighter-rouge">lib.getPrice.restype = c_char_p</code> - Set the return type to the corresponding C type.</p>

<p><code class="language-plaintext highlighter-rouge">price = lib.getPrice(ticker.encode(), curr_date.encode()).decode()</code> - We call the <code class="language-plaintext highlighter-rouge">getPrice</code> function and convert the Python string arguments into bytes that can be passed to the Go function by calling <code class="language-plaintext highlighter-rouge">.encode</code>. We then receive the output from Go function as bytes so we <code class="language-plaintext highlighter-rouge">decode</code> it to convert it to a Python string.</p>

<h2 id="conclusion">
<a class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2>
<p>You now have most of the knowledge you need to get started creating wrappers for compiled language functions. No longer are you bound by the cons of interpreter based languages. You can create modules in languages that better suit your use case, and then fall back on Python to build out a user friendly API or the core of your application. Happy coding!</p>

<h2 id="feedback">
<a class="anchor" href="#feedback" aria-hidden="true"><span class="octicon octicon-link"></span></a>Feedback</h2>
<p>I encourage any and all feedback about any of my posts and tutorials. You can message me on  <a href="https://twitter.com/ashtonasidhu">twitter</a>  or e-mail me at  <a href="mailto:sidhuashton@gmail.com">sidhuashton@gmail.com</a> .</p>

  </div><a class="u-url" href="/blog/python/data%20science/go/machine%20learning/2020/10/25/ctypes-go.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My tech blog for tutorials, guides and opinions!</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/Ashton-Sidhu" target="_blank" title="Ashton-Sidhu"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/ashtonasidhu" target="_blank" title="ashtonasidhu"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
